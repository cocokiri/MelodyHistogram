<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>BarTones</title>
    <link rel="stylesheet" href="style.css">
    <script src="../MyFunctions/SwagLib.js">
    </script>
</head>

<body>

    <div class="container" id="allBoxes">
        <div class="box box1">C</div>
        <div class="box box2">2</div>
        <div class="box box3">D</div>
        <div class="box box4">4</div>
        <div class="box box5">5</div>
        <div class="box box6">6</div>
        <div class="box box7">7</div>
        <div class="box box8">8</div>
        <div class="box box9">9</div>
        <div class="box box10">10</div>
    </div>

</body>

</html>

<script>
    window.addEventListener("load", init);

    let boxes;
    let frameCount = 0;
    let currentInput = 0;
    let keyboardInput = [];
    let pressCount = 0;
    let keyboardCodes = [65, 83, 68, 70, 81, 87, 69, 82, 49, 50, 51, 52];

    document.onkeydown = KeyCheck;
    window.onkeydown = KeyCheck;
    //Two "simulateneous" Listeners somehow recognize multiple touches faster

    document.onkeyup = (ev) =>
    keyboardInput = keyboardInput.filter(
            (element) => element !== keyboardCodes.indexOf(ev.keyCode));

    //maps keyboard input into 0-12 scheme
    function KeyCheck() {
        let key = event.keyCode;
        console.log(keyboardInput);

        for (let i = 0; i < keyboardCodes.length; i++) {
            if (key === keyboardCodes[i] &&
                !(keyboardInput.includes(i))) {
                keyboardInput.push(i);
            }
        }
    }
    // function keyboardInputToNumber

    function init() {
        let boxesHTMLCollection = document.getElementById("allBoxes").children;
        boxes = [...boxesHTMLCollection]; //go from useless htmlCollection to Array!
        //= Array.from(boxesHTMLCollection);
        //= Array.prototype.slice.call( htmlCollection )
        //= [].slice.call(htmlCollection) //creates unnecessary array instance
        console.log(boxes.length);
        console.log(boxes);

        loop(); //sets counter to 0
    };

    function loop() {
        if (keyboardInput.length > 0) { //(typeof keyboardInput[0] !== 'undefined' && keyboardInput[0] !== null)
            //if something is pressed
            currentInput = keyboardInput[0];
            if (frameCount < 100) {
                frameCount++;
            }
        } else if (frameCount > 0) {
            frameCount--;
        }

        let percentage = frameCount / 100;
        let box = boxes[currentInput];

        box.style.background = NumberToHSLa(currentInput, undefined, undefined, 1); //"hsla(30,50%,50%," + (frameCount*frameCount)/(100*100); + ")";
        box.style.height = 8 + percentage * currentInput * 10 + "vh";
        box.style.opacity = percentage
        box.style.borderTopLeftRadius = frameCount * Math.sin(Math.PI * percentage) + "px"; //acceleration = sinus
        box.style.borderTopRightRadius = frameCount * Math.sin(Math.PI * percentage) + "px";

        requestAnimationFrame(loop); //loop(frameCount) gives error as a callback
    }
    // function legitTone () {};
    // function setBoxHeight(box, height);
    //if (endofTone) / (newTone) animate or slap text on it
</script>
